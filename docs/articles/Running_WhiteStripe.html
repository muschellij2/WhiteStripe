<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Running WhiteStripe on T1- and T2-weighted Imaging â€¢ WhiteStripe</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Running WhiteStripe on T1- and T2-weighted Imaging">
<meta property="og:description" content="WhiteStripe">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">WhiteStripe</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.4.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Running_WhiteStripe.html">Running WhiteStripe on T1- and T2-weighted Imaging</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/muschellij2/WhiteStripe/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Running WhiteStripe on T1- and T2-weighted Imaging</h1>
                        <h4 data-toc-skip class="author">John Muschelli</h4>
            
            <h4 data-toc-skip class="date">2022-08-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/muschellij2/WhiteStripe/blob/HEAD/vignettes/Running_WhiteStripe.Rmd" class="external-link"><code>vignettes/Running_WhiteStripe.Rmd</code></a></small>
      <div class="hidden name"><code>Running_WhiteStripe.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="downloading-the-data">Downloading the data<a class="anchor" aria-label="anchor" href="#downloading-the-data"></a>
</h2>
<p>First, we would like to make sure we have some data to work with. The data is not located directly in the installed package to make it lightweight and some other repository restrictions.</p>
<p>To download the test data, we will use the WhiteStripe function <code>download_img_data</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">WhiteStripe</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/download_img_data.html">download_img_data</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<div class="section level3">
<h3 id="getting-the-filenames">Getting the filenames<a class="anchor" aria-label="anchor" href="#getting-the-filenames"></a>
</h3>
<p>Once the data is downloaded, we can access the files using the <code>ws_img_data</code> function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">files</span> <span class="op">=</span> <span class="fu"><a href="../reference/ws_img_data.html">ws_img_data</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="reading-in-the-data">Reading in the data<a class="anchor" aria-label="anchor" href="#reading-in-the-data"></a>
</h2>
<p>We will focus on the T1-weighted image here:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rigorousanalytics.blogspot.com" class="external-link">oro.nifti</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## oro.nifti 0.11.4</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t1</span> <span class="op">=</span> <span class="va">files</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"T1"</span>, <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">files</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">img</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/oro.nifti/man/read_nifti.html" class="external-link">readNIfTI</a></span><span class="op">(</span>fname <span class="op">=</span> <span class="va">t1</span>, reorient <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="displaying-the-data">Displaying the data<a class="anchor" aria-label="anchor" href="#displaying-the-data"></a>
</h3>
<p>Here we will display the data in 3-dimensions and note that it is a skull-stripped image:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/oro.nifti/man/orthographic-methods.html" class="external-link">orthographic</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span></span></code></pre></div>
<p><img src="Running_WhiteStripe_files/figure-html/unnamed-chunk-1-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vals</span> <span class="op">=</span> <span class="va">img</span><span class="op">[</span><span class="va">img</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">vals</span>, breaks <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></span></code></pre></div>
<p><img src="Running_WhiteStripe_files/figure-html/hist-1.png" width="700"></p>
<p>Here we see the distribution of non-zero values. We use <code>2000</code> breaks, as this is the default in <code>whitestripe</code>. For <code>T1</code> images, <code>whitestripe</code> will use the last mode (intensity around <code>85</code>) in this data.</p>
</div>
</div>
<div class="section level2">
<h2 id="running-whitestripe">Running WhiteStripe<a class="anchor" aria-label="anchor" href="#running-whitestripe"></a>
</h2>
<p>Since the image is skull stripped, we will set <code>stripped = TRUE</code> in the <code>whitestripe</code> function:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ws</span> <span class="op">=</span> <span class="fu"><a href="../reference/whitestripe.html">whitestripe</a></span><span class="op">(</span>img <span class="op">=</span> <span class="va">img</span>, type <span class="op">=</span> <span class="st">"T1"</span>, stripped <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Making Image VOI</span></span></code></pre>
<pre><code><span><span class="co">## Making T1 Histogram</span></span></code></pre>
<pre><code><span><span class="co">## Getting T1 Modes</span></span></code></pre>
<pre><code><span><span class="co">## Smoothing Histogram</span></span></code></pre>
<pre><code><span><span class="co">## Smoothing Derivative</span></span></code></pre>
<pre><code><span><span class="co">## Quantile T1 VOI</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ws</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "whitestripe.ind"     "img.mode"            "mask.img"           </span></span>
<span><span class="co">##  [4] "mu.whitestripe"      "sig.whitestripe"     "img.mode.q"         </span></span>
<span><span class="co">##  [7] "whitestripe"         "whitestripe.width"   "whitestripe.width.l"</span></span>
<span><span class="co">## [10] "whitestripe.width.u" "err"</span></span></code></pre>
<p>We see the progress points and the names of the output. This returns the indices of the whitestripe and a <code>mask.img</code> element, which is used to normalize the image:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">norm</span> <span class="op">=</span> <span class="fu"><a href="../reference/whitestripe_norm.html">whitestripe_norm</a></span><span class="op">(</span>img <span class="op">=</span> <span class="va">img</span>, indices <span class="op">=</span> <span class="va">ws</span><span class="op">$</span><span class="va">whitestripe.ind</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="displaying-the-output">Displaying the output<a class="anchor" aria-label="anchor" href="#displaying-the-output"></a>
</h3>
<div class="section level4">
<h4 id="location-of-the-white-stripe">Location of the white stripe<a class="anchor" aria-label="anchor" href="#location-of-the-white-stripe"></a>
</h4>
<p>We can visualize the mode selected and the white stripe:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">vals</span>, breaks <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">ws</span><span class="op">$</span><span class="va">mu.whitestripe</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">ws</span><span class="op">$</span><span class="va">whitestripe</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Running_WhiteStripe_files/figure-html/print_ws-1.png" width="700"></p>
<p>Here we see the blue line for the mode and the red lines for the voxel intensities within the white stripe.</p>
</div>
<div class="section level4">
<h4 id="white-stripe-mask">White stripe mask<a class="anchor" aria-label="anchor" href="#white-stripe-mask"></a>
</h4>
<p>We can also overlay the mask used for the white stripe:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mask</span> <span class="op">=</span> <span class="va">ws</span><span class="op">$</span><span class="va">mask.img</span></span>
<span><span class="va">mask</span><span class="op">[</span><span class="va">mask</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/oro.nifti/man/orthographic-methods.html" class="external-link">orthographic</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">img</span>, y <span class="op">=</span> <span class="va">mask</span>, col.y <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Running_WhiteStripe_files/figure-html/ortho_overlay-1.png" width="700"></p>
<p>We see white matter selected, but the fact that more values within the posterior compared to the anterior part of the brain may indicate a inhomogeneity correction needs to be applied before running <code>whitestripe</code>.</p>
</div>
<div class="section level4">
<h4 id="normalized-intensities">Normalized intensities<a class="anchor" aria-label="anchor" href="#normalized-intensities"></a>
</h4>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">norm_vals</span> <span class="op">=</span> <span class="va">norm</span><span class="op">[</span><span class="va">img</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">norm_vals</span>, breaks <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></span></code></pre></div>
<p><img src="Running_WhiteStripe_files/figure-html/norm_hist-1.png" width="700"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>Here is a brief overview of the functionality of the WhiteStripe package. Additional information requests are welcome to the bug report/issue page.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by R. Taki Shinohara, John Muschelli.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
